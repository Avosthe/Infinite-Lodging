@page
@model SSDAssignment40.Pages.DetailsModel

@inject UserManager<Lodger> _userManager
@{
    ViewData["Title"] = "Details";
}

<script src="~/js/listings.js"></script>
<div style="width:100%;display:block;">
    <h2 style="width:50%;display:inline-block;float:left">Listing Details</h2>
    @if (@Model.Listing.Lodger.Id == _userManager.GetUserId(User))
    {
        <a asp-page="./EditListing" asp-route-id="@Model.Listing.ListingId">
            <div style="display:block;float:right;margin-top:20px;" class="clickbutton">
                Edit Listing
            </div>
        </a>
    }
</div>
<section style="width:100%;height:50vh;overflow:hidden;display:inline-block">
    <img class="detailscoverpic" id="coverpic" src="~/ListingCover/@Model.Listing.CoverPic" />
    <div id="myModal" class="modal">
        <span class="close">&times;</span>
        <img class="detailscoverpic modal-content" id="modalcover" src="~/ListingCover/@Model.Listing.CoverPic" />
    </div>
</section>
<div class="listingwrapper">
    <div class="listingdetails">
        <div class="titleuserdetail">
            <div class="listingdetailtitle">
                <header style="font-size:36px;">
                    @Html.DisplayFor(model => model.Listing.Title)
                </header>
            </div>
            <div class="listerinfo">
                <a style="text-decoration:none;" href="/Profile/@Model.Listing.Lodger.UserName">
                    <img style="width:50px;height:50px;border-radius:50%;" src="~/profile-images/@Model.Listing.Lodger.ProfilePic" />
                </a>
                <div>
                    @Model.Listing.Lodger.UserName
                </div>
            </div>
        </div>
        <div style="font-size:16px;">
            @Html.DisplayFor(model => model.Listing.Desc)
        </div>

    </div>
    <div class="hidden" id="price">@Model.Listing.Price</div>
    <div style="float:left;">
        <div class="listingbooking">
            <b style="font-size:24px;">$SGD @Model.Listing.Price</b> per night
            <form method="post" enctype="multipart/form-data">
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                <div class="form-group">
                    <label>From</label>
                    <input type="date" onchange="updatePrice()" id="dateStart" asp-for="Booking.DateStart" class="form-control" required />
                    <span asp-validation-for="Booking.DateStart" class="text-danger"></span>
                </div>
                <div class="form-group">
                    <label>To</label>
                    <input type="date" onchange="updatePrice()" id="dateEnd" asp-for="Booking.DateEnd" class="form-control" required />
                    <span asp-validation-for="Booking.DateEnd" class="text-danger"></span>
                </div>
                <div id="bookingprice">
                    <div id="calculation"></div><div id="calctotal"></div>
                    <div id="line"></div>
                    <div id="totalprice">Total Price</div><div id="total"></div>
                </div>
                <div class="buttoncontainer" style="margin:auto">
                    <div class="form-group">
                        <input type="submit" value="Book" class="clickbuttonnoshadow" />
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<div class="buttoncontainer">
    <a asp-page="./Listings">
        <div class="clickbuttonnoshadow">
            <<< Back to Listings
        </div>
    </a>
</div>

<script>
    // Get the modal
    var modal = document.getElementById('myModal');

    // Get the image and insert it inside the modal - use its "alt" text as a caption
    var img = document.getElementById('coverpic');
    var modalImg = document.getElementById("modalcover");
    img.onclick = function () {
        modal.style.display = "block";
        modalImg.src = this.src;
    }

    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];

    // When the user clicks on <span> (x), close the modal
    span.onclick = function () {
        modal.style.display = "none";
    }
</script>
